flowchart LR
  client[Client / Meeting] -->|WS audio.chunk| api[API Gateway]
  api -->|enqueue STT| qstt[(Redis Q:stt)]
  qstt --> stt[worker-stt]
  stt -->|raw segments| db[(PostgreSQL)]
  stt -->|audio in S3| s3[(S3/MinIO)]

  stt -->|enqueue enhancer| qenh[(Redis Q:enhancer)]
  qenh --> enh[worker-enhancer]
  enh -->|enhanced segments| db

  enh -->|enqueue analytics| qanl[(Redis Q:analytics)]
  qanl --> anl[worker-analytics]
  anl -->|report| db
  anl -->|LLM calls| llm[(OpenAI-compat LLM)]

  anl -->|enqueue delivery| qdlv[(Redis Q:delivery)]
  qdlv --> dlv[worker-delivery]
  dlv -->|email/report| mail[SMTP/Email]
  dlv -->|delivery status| db

  dlv -->|enqueue retention| qret[(Redis Q:retention)]
  qret --> ret[worker-retention]
  ret -->|cleanup| s3
  ret -->|cleanup| db

  api -->|WS transcript.update| client

  api --> metrics[/metrics/]
  metrics --> prom[Prometheus]
  prom --> graf[Grafana]
