\1ARG DEBIAN_FRONTEND=noninteractive
ENV DEBIAN_FRONTEND=noninteractive

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# Системные зависимости для typical Python stacks (минимум)
RUN apt-get update && apt-get install -y --no-install-recommends \ \
 && rm -rf /var/lib/apt/lists/*
    curl ca-certificates \
    libpq5 libpq-dev \
    ffmpeg \
    make \
  && rm -rf /var/lib/apt/lists/*

COPY requirements.txt /app/requirements.txt
RUN python -m pip install -U pip && pip install -r /app/requirements.txt

COPY src /app/src
COPY apps /app/apps
COPY tools /app/tools
COPY tests /app/tests
COPY pyproject.toml /app/pyproject.toml

COPY Makefile /app/Makefile
ENV PYTHONPATH=/app/src

EXPOSE 8010

CMD ["bash","-lc","python -m uvicorn apps.api_gateway.main:app --host 0.0.0.0 --port 8010"]
