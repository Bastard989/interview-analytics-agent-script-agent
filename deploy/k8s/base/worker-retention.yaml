apiVersion: apps/v1
kind: Deployment
metadata:
  name: agent-worker-retention
spec:
  replicas: 1
  selector:
    matchLabels:
      app: agent-worker-retention
  template:
    metadata:
      labels:
        app: agent-worker-retention
    spec:
      containers:
        - name: worker-retention
          image: ghcr.io/your-org/interview-analytics-agent:latest
          imagePullPolicy: IfNotPresent
          command: ["python3", "-m", "apps.worker_retention.main"]
          envFrom:
            - configMapRef:
                name: agent-config
          env:
            - name: SERVICE_NAME
              value: "worker-retention"
            - name: CHUNKS_DIR
              value: "/data/chunks"
            - name: STORAGE_SHARED_FS_DIR
              value: "/data/chunks"
            - name: POSTGRES_DSN_FILE
              value: "/secrets/postgres_dsn"
            - name: REDIS_URL_FILE
              value: "/secrets/redis_url"
            - name: API_KEYS_FILE
              value: "/secrets/api_keys"
            - name: SERVICE_API_KEYS_FILE
              value: "/secrets/service_api_keys"
            - name: JWT_SHARED_SECRET_FILE
              value: "/secrets/jwt_shared_secret"
            - name: SBERJAZZ_API_TOKEN_FILE
              value: "/secrets/sberjazz_api_token"
          volumeMounts:
            - name: shared-data
              mountPath: /data
            - name: agent-secrets
              mountPath: /secrets
              readOnly: true
          resources:
            requests:
              cpu: "200m"
              memory: "256Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
      volumes:
        - name: shared-data
          persistentVolumeClaim:
            claimName: agent-shared-pvc
        - name: agent-secrets
          secret:
            secretName: agent-secrets
