# =============================================================================
# ОБЩЕЕ
# =============================================================================
APP_ENV=dev
SERVICE_NAME=api-gateway

API_HOST=0.0.0.0
API_PORT=8010
# CSV список origin'ов для CORS; в APP_ENV=prod нельзя оставлять '*'
CORS_ALLOWED_ORIGINS=*
# Если CORS_ALLOWED_ORIGINS=* — приложение принудительно выключит credentials
CORS_ALLOW_CREDENTIALS=true

# =============================================================================
# AUTH
# =============================================================================
# api_key|jwt|none
AUTH_MODE=jwt
# Если AUTH_MODE=api_key, перечисляй ключи через запятую: key1,key2,key3
API_KEYS=
# Service-to-service ключи (в AUTH_MODE=jwt fallback работает только для service ключей)
SERVICE_API_KEYS=
# В APP_ENV=prod AUTH_MODE=none запрещён
ALLOW_SERVICE_API_KEY_IN_JWT_MODE=true

# JWT/OIDC (production)
OIDC_ISSUER_URL=
OIDC_JWKS_URL=
OIDC_AUDIENCE=
OIDC_ALGORITHMS=RS256
OIDC_DISCOVERY_TIMEOUT_SEC=5
JWT_CLOCK_SKEW_SEC=30
JWT_SERVICE_CLAIM_KEY=token_type
JWT_SERVICE_CLAIM_VALUES=service,client_credentials,m2m
JWT_SERVICE_ROLE_CLAIM=roles
JWT_SERVICE_ALLOWED_ROLES=service,admin

# DEV ONLY: shared secret для локальной проверки JWT без OIDC
JWT_SHARED_SECRET=

# =============================================================================
# DB / REDIS
# =============================================================================
POSTGRES_DSN=postgresql+psycopg://postgres:postgres@postgres:5432/agent
REDIS_URL=redis://redis:6379/0

# =============================================================================
# =============================================================================

# =============================================================================
# PII / RETENTION
# =============================================================================
PII_MASKING=true
RETENTION_DAYS_AUDIO=14
RETENTION_DAYS_TEXT=90

# =============================================================================
# STT (Speech-to-Text) — РАСПОЗНАВАНИЕ РЕЧИ
# =============================================================================
# Провайдер распознавания речи:
# whisper_local|google|salutespeech
STT_PROVIDER=whisper_local

# --- Локальный Whisper (faster-whisper) ---
# Модель: tiny|base|small|medium|large-v3
WHISPER_MODEL_SIZE=small
# cpu|cuda (для презентации/теста обычно cpu)
WHISPER_DEVICE=cpu
# int8 (быстрее на CPU) / float16/float32 (тяжелее)
WHISPER_COMPUTE_TYPE=int8
# Язык: ru|en|auto
WHISPER_LANGUAGE=ru
# VAD фильтр (часто улучшает качество на шумных сегментах)
WHISPER_VAD_FILTER=true
# beam_size (1 быстрее, 3-5 точнее)
WHISPER_BEAM_SIZE=1

# =============================================================================
# MEETING CONNECTOR (SBERJAZZ TARGET)
# =============================================================================
# sberjazz|sberjazz_mock|none
MEETING_CONNECTOR_PROVIDER=sberjazz_mock
SBERJAZZ_API_BASE=
SBERJAZZ_API_TOKEN=
SBERJAZZ_TIMEOUT_SEC=10
SBERJAZZ_RETRIES=2
SBERJAZZ_RETRY_BACKOFF_MS=300
SBERJAZZ_SESSION_TTL_SEC=86400
SBERJAZZ_RECONCILE_STALE_SEC=900
RECONCILIATION_ENABLED=true
RECONCILIATION_INTERVAL_SEC=60
RECONCILIATION_LIMIT=200

# =============================================================================
# LLM (OpenAI-compatible) — ДЛЯ ОТЧЁТА/АНАЛИТИКИ
# =============================================================================
LLM_ENABLED=false
OPENAI_API_BASE=http://host.docker.internal:11434/v1
OPENAI_API_KEY=
LLM_MODEL_ID=llama3:8b
LLM_TEMPERATURE=0.7

LLM_MAX_TOKENS=2048
LLM_TOP_P=0.95
LLM_FREQUENCY_PENALTY=0.0
LLM_PRESENCE_PENALTY=0.0
LLM_REQUEST_TIMEOUT_SEC=30
LLM_RETRIES=2
LLM_RETRY_BACKOFF_MS=250

# =============================================================================
# DELIVERY / SMTP (если хочешь отправку email)
# =============================================================================
DELIVERY_PROVIDER=email
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
EMAIL_FROM=hr-agent@example.com

# =============================================================================
# LOGGING
# =============================================================================
LOG_LEVEL=INFO
# json|text
LOG_FORMAT=json
